# START: nginx -c `pwd`/nginx.conf
# STOP : nginx -c `pwd`/nginx.conf -s quit

worker_processes 1;

events {
    worker_connections 1024;
}

http {
    default_type  application/octet-stream;
    client_max_body_size 4m;
    
    keepalive_timeout 65;
    upstream backend_servers {
	    server localhost:7001 max_fails=3 fail_timeout=30s;
	    server localhost:7002 max_fails=3 fail_timeout=30s backup weight=2000000000;
	    server localhost:7003 max_fails=3 fail_timeout=30s backup weight=1;
    }

    server {
        listen 8001;
        server_name example.com;

	    location / {
		    proxy_pass http://backend_servers;
	    }
    }
}

